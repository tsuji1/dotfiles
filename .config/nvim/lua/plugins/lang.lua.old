return {
	{
		"neovim/nvim-lspconfig",
		-- ← これが無いと config が走らないことがある
		event = { "BufReadPre", "BufNewFile", "VeryLazy" },

		config = function()
			-- pipx の bin を Neovim 内 PATH に足す（安全のため起動毎に）
			local pipx_bin = vim.fn.expand("~/.local/bin")
			if not vim.env.PATH:find(pipx_bin, 1, true) then
				vim.env.PATH = pipx_bin .. ":" .. vim.env.PATH
			end

			-- cmp-nvim-lsp が無くても落ちない capabilities
			local caps = vim.lsp.protocol.make_client_capabilities()
			pcall(function()
				caps = require("cmp_nvim_lsp").default_capabilities(caps)
			end)

			-- 全サーバ共通
			vim.lsp.config("*", {
				capabilities = caps,
				on_attach = function(_, bufnr)
					local map = function(m, lhs, rhs, d)
						vim.keymap.set(m, lhs, rhs, { buffer = bufnr, silent = true, noremap = true, desc = d })
					end
					map("n", "gd", vim.lsp.buf.definition, "LSP: definition")
					map("n", "gD", vim.lsp.buf.declaration, "LSP: declaration")
					map("n", "gr", vim.lsp.buf.references, "LSP: references")
					map("n", "gi", vim.lsp.buf.implementation, "LSP: implementations")
					map("n", "K", vim.lsp.buf.hover, "LSP: hover")
					map("n", "<leader>lr", vim.lsp.buf.rename, "LSP: rename")
					map("n", "<leader>la", vim.lsp.buf.code_action, "LSP: code action")
					map("n", "<leader>lf", function()
						vim.lsp.buf.format({ async = true })
					end, "LSP: format")
				end,
			})

			-- ---------- 個別: Python (pylsp) ----------
			local pylsp_cmd = (function()
				local p = vim.fn.exepath("pylsp")
				if p ~= "" then
					return { p }
				end
				-- フォールバック（pipx の標準場所）
				local fb = vim.fn.expand("~/.local/bin/pylsp")
				return { fb }
			end)()

			vim.lsp.config("pylsp", {
				cmd = pylsp_cmd,
				-- プロジェクトに pyproject 等が無くても付くよう CWD を root に
				root_dir = function()
					return vim.loop.cwd()
				end,
				settings = {
					pylsp = {
						plugins = {
							pyflakes = { enabled = false },
							pycodestyle = { enabled = false },
							mccabe = { enabled = false },
							-- jedi 系は補完/hover に必要なので有効でOK
							jedi_completion = { enabled = true },
							jedi_hover = { enabled = true },
							jedi_symbols = { enabled = true },
						},
					},
				},
			})

			-- ---------- 以降は “入っていれば使う” ----------
			if vim.fn.exepath("lua-language-server") ~= "" then
				vim.lsp.config("lua_ls", {
					settings = {
						Lua = {
							diagnostics = { globals = { "vim" } },
							workspace = { checkThirdParty = false },
							telemetry = { enable = false },
						},
					},
				})
			end

			if vim.fn.exepath("yaml-language-server") ~= "" then
				vim.lsp.config("yamlls", { settings = { yaml = { keyOrdering = false } } })
			end

			if vim.fn.exepath("vscode-json-language-server") ~= "" then
				vim.lsp.config("jsonls", {})
			end

			if vim.fn.exepath("bash-language-server") ~= "" then
				vim.lsp.config("bashls", {})
			end
		end,
	},
}
